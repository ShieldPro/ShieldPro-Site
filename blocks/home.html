<header>ShieldPro ðŸ‘‹</header>
<span>Hello, I am pol<red>ish</red> developer!</span>

<hr>

<div id="mainSocials">
    <div class="row gap-2" style="margin: 0 !important; padding: 0 !important;">
        <div id="discord" class="col-12 socials">
            <div id="discordUserInfo" class="col-12">
                <img id="avatar" src="img/default_avatar.png" height="90px">

                <div id="discordDetails">
                    <div id="discordHeadDiv">
                        <span id="discordDisplayName">Loading...</span>

                        <div id="badges">
                            <img onmouseenter="showTooltip(this, 'HypeSquad Brilliance')" onmouseleave="hideTooltip()" src="img/brilliance.png" width="18px">
                            <img onmouseenter="showTooltip(this, 'Active Developer')" onmouseleave="hideTooltip()" src="img/developer.png" width="18px">
                            <img onmouseenter="showTooltip(this, 'Subscriber since Apr 7, 2022')" onmouseleave="hideTooltip()" src="img/nitro.png" width="18px">
                            <img onmouseenter="showTooltip(this, 'Server boosting since Apr 7, 2022')" onmouseleave="hideTooltip()" src="img/boost.png" width="18px">
                        </div>
                    </div>
                    <span id="discordUsername">Loading...</span>
                    <span id="discordStatus"></span>
                </div>
            </div>

            <div id="discordPresence">
                <hr style="background: rgba(255, 255, 255, 0.1) !important; margin-bottom: 0 !important;">

            </div>
        </div>

        <div id="spotify" class="col-12 socials">
            <img id="trackImage" src="img/no_music.png" height="90px">

            <div id="trackDetails">
                <span style="font-size: 70%; color: rgb(131, 131, 131) !important;"><b>LISTENING TO</b></span>
                <span id="lastTrackName">Not Listening</span>
                <span id="lastTrackArtist"></span>
            </div>
        </div>
    </div>
</div>

<div id="otherSocials">
    <b>MY SOCIALS</b>
    <div id="socialIcons">
        <a href="https://pl.namemc.com/profile/ShieldPro.2" target="_blank" onmouseenter="showTooltip(this, 'NameMC')" onmouseleave="hideTooltip()">
            <svg viewBox="-8 -8 16 16" shape-rendering="crispEdges" class="align-top">
                <path style="fill:white" d="M-5-5L+3-5L+3-3L+5-3L+5+5L+3+5L+3-3L-3-3L-3+5L-5+5"></path>
            </svg>
        </a>
        <a href="https://open.spotify.com/user/1193058499" target="_blank" onmouseenter="showTooltip(this, 'Spotify')" onmouseleave="hideTooltip()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="rgb(30, 215, 96)" class="bi bi-spotify" viewBox="0 0 16 16">
                <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.669 11.538a.498.498 0 0 1-.686.165c-1.879-1.147-4.243-1.407-7.028-.77a.499.499 0 0 1-.222-.973c3.048-.696 5.662-.397 7.77.892a.5.5 0 0 1 .166.686zm.979-2.178a.624.624 0 0 1-.858.205c-2.15-1.321-5.428-1.704-7.972-.932a.625.625 0 0 1-.362-1.194c2.905-.881 6.517-.454 8.986 1.063a.624.624 0 0 1 .206.858zm.084-2.268C10.154 5.56 5.9 5.419 3.438 6.166a.748.748 0 1 1-.434-1.432c2.825-.857 7.523-.692 10.492 1.07a.747.747 0 1 1-.764 1.288z"/>
            </svg>
        </a>
        <a href="https://www.youtube.com/@ShieldPro360?sub_confirmation=1" target="_blank" onmouseenter="showTooltip(this, 'YouTube')" onmouseleave="hideTooltip()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="rgb(255, 50, 50)" class="bi bi-youtube" viewBox="0 0 16 16">
                <path d="M8.051 1.999h.089c.822.003 4.987.033 6.11.335a2.01 2.01 0 0 1 1.415 1.42c.101.38.172.883.22 1.402l.01.104.022.26.008.104c.065.914.073 1.77.074 1.957v.075c-.001.194-.01 1.108-.082 2.06l-.008.105-.009.104c-.05.572-.124 1.14-.235 1.558a2.007 2.007 0 0 1-1.415 1.42c-1.16.312-5.569.334-6.18.335h-.142c-.309 0-1.587-.006-2.927-.052l-.17-.006-.087-.004-.171-.007-.171-.007c-1.11-.049-2.167-.128-2.654-.26a2.007 2.007 0 0 1-1.415-1.419c-.111-.417-.185-.986-.235-1.558L.09 9.82l-.008-.104A31.4 31.4 0 0 1 0 7.68v-.123c.002-.215.01-.958.064-1.778l.007-.103.003-.052.008-.104.022-.26.01-.104c.048-.519.119-1.023.22-1.402a2.007 2.007 0 0 1 1.415-1.42c.487-.13 1.544-.21 2.654-.26l.17-.007.172-.006.086-.003.171-.007A99.788 99.788 0 0 1 7.858 2h.193zM6.4 5.209v4.818l4.157-2.408L6.4 5.209z"/>
            </svg>
        </a>
        <a href="https://steamcommunity.com/profiles/76561199098269252/" target="_blank" onmouseenter="showTooltip(this, 'Steam')" onmouseleave="hideTooltip()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="rgb(199, 213, 224)" class="bi bi-steam" viewBox="0 0 16 16">
                <path d="M.329 10.333A8.01 8.01 0 0 0 7.99 16C12.414 16 16 12.418 16 8s-3.586-8-8.009-8A8.006 8.006 0 0 0 0 7.468l.003.006 4.304 1.769A2.198 2.198 0 0 1 5.62 8.88l1.96-2.844-.001-.04a3.046 3.046 0 0 1 3.042-3.043 3.046 3.046 0 0 1 3.042 3.043 3.047 3.047 0 0 1-3.111 3.044l-2.804 2a2.223 2.223 0 0 1-3.075 2.11 2.217 2.217 0 0 1-1.312-1.568L.33 10.333Z"/>
                <path d="M4.868 12.683a1.715 1.715 0 0 0 1.318-3.165 1.705 1.705 0 0 0-1.263-.02l1.023.424a1.261 1.261 0 1 1-.97 2.33l-.99-.41a1.7 1.7 0 0 0 .882.84Zm3.726-6.687a2.03 2.03 0 0 0 2.027 2.029 2.03 2.03 0 0 0 2.027-2.029 2.03 2.03 0 0 0-2.027-2.027 2.03 2.03 0 0 0-2.027 2.027Zm2.03-1.527a1.524 1.524 0 1 1-.002 3.048 1.524 1.524 0 0 1 .002-3.048Z"/>
              </svg>
        </a>
    </div>
</div>

<script>
    document.title = "ShieldPro ðŸ‘‹";

    async function loadSpotify() {
        const refreshToken = await fetch("refresh_token.txt")
            .then((res) => res.text())
            .then((text) => {
                return text;
            })
            .catch((e) => console.error(e));

        const clientId = 'ef2837ceaa544a419b7fa13e431055a0';
        const clientSecret = '15935f3df0974840a7290eb3b2272204';

        async function refreshAccessToken() {
            try {
                const response = await fetch('https://accounts.spotify.com/api/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'Authorization': 'Basic ' + btoa(clientId + ':' + clientSecret)
                    },
                    body: `grant_type=refresh_token&refresh_token=${refreshToken}`
                });

                const data = await response.json();
                return data.access_token;
            } catch (error) {
                console.error('BÅ‚Ä…d podczas odÅ›wieÅ¼ania access_token spotify.' /*+ error*/);
            }
        }

        const accessToken = await refreshAccessToken();
        async function getCurrentlyPlaying() {
            try {
                const response = await fetch('https://api.spotify.com/v1/me/player/currently-playing', {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });

                if (response.status === 200) {
                    const data = await response.json();
                    var artists = [];
                    data.item.artists.forEach(element => {
                        artists.push(element.name);
                    });
                    document.querySelector("#lastTrackName").innerHTML = data.item.name;
                    document.querySelector("#trackImage").src = data.item.album.images[0].url;
                    document.querySelector("#lastTrackArtist").innerHTML = artists.join(", ");
                    //console.log(JSON.stringify(data))
                } else {
                    console.log('Brak odtwarzanej muzyki.');
                }
            } catch (error) {
                console.log('WystÄ…piÅ‚ bÅ‚Ä…d.' /*+ error*/);
            }
        }
        getCurrentlyPlaying()
    }
    loadSpotify()

    async function loadDiscord() {
        const response = await fetch("https://api.lanyard.rest/v1/users/472803917072171026");
        const jsonData = await response.json();
        document.querySelector("#avatar").src = "https://cdn.discordapp.com/avatars/472803917072171026/" + jsonData.data.discord_user.avatar + "?size=512";
        document.querySelector("#discordDisplayName").innerHTML = "<b>" + jsonData.data.discord_user.display_name + "</b>";
        document.querySelector("#discordUsername").innerHTML = jsonData.data.discord_user.username;
        document.querySelector("#avatar").onmouseenter = function(){showTooltip(this, (jsonData.data.discord_status == "dnd") ? "Do Not Disturb" : jsonData.data.discord_status)};
        document.querySelector("#avatar").onmouseleave = function(){hideTooltip()};
        if (jsonData.data.discord_status == "offline"){return}

        if (jsonData.data.activities[0].type == 4){
            document.querySelector("#discordStatus").innerHTML = jsonData.data.activities[0].state;
        }else if(jsonData.data.activities[0].type == 2){
            document.querySelector("#discordStatus").innerHTML = "Listening to <b>" + jsonData.data.activities[0].name + "</b>";
        }else if(jsonData.data.activities[0].type == 0){
            document.querySelector("#discordStatus").innerHTML = "In <b>" + jsonData.data.activities[0].name + "</b>";
        }

        if (jsonData.data.discord_status == "dnd"){
            document.querySelector("#avatar").style.borderColor = "#f23f43";
        }else if(jsonData.data.discord_status == "idle"){
            document.querySelector("#avatar").style.borderColor = "#f0b232";
        }else if(jsonData.data.discord_status == "online"){
            document.querySelector("#avatar").style.borderColor = "#23a55a";
        }

        // DISCORD PRESENCE
        var activity;
        await jsonData.data.activities.forEach(e => {
            if (e.type == 0){
                var div = document.createElement("div");
                div.innerHTML = `
                    <span style="font-size: 70%; color: rgb(131, 131, 131);"><b>PLAYING A GAME</b></span>
                    <div class="discordPresenceContent">
                        <img src='${e.assets ? "https://cdn.discordapp.com/app-assets/" + e.application_id + "/" + e.assets.large_image + ".png" : "https://dcdn.dstn.to/app-icons/" + e.application_id}'>
                        
                        <div>
                            <span><b>${e.name}</b></span>
                            <span>${e.details || ""}</span>
                            <span>${e.state || ""}</span>
                            <span>${e.timestamps.start ? new Date(Date.now() - e.timestamps.start).toISOString().slice(11, 19) + " elapsed" : ""}</span>
                        </div>
                    </div>
                `;
                document.querySelector("#discordPresence").appendChild(div);
            }
        });

        console.log(activity)

        // document.querySelector("#presenceAvatar").src = activity.assets ? "https://cdn.discordapp.com/app-assets/" + activity.application_id + "/" + activity.assets.large_image + ".png" : "https://dcdn.dstn.to/app-icons/" + activity.application_id;
        // document.querySelector("#presenceName").innerHTML = "<b>" + activity.name + "</b>";
        // document.querySelector("#presenceDescription").innerHTML = activity.details || "";
        // document.querySelector("#presenceState").innerHTML = activity.state || "";
        // document.querySelector("#presenceTime").innerHTML = activity.timestamps.start ? new Date(Date.now() - activity.timestamps.start).toISOString().slice(11, 19) + " elapsed" : "";
        // document.querySelector("#discordPresence").style.display = "flex";
        // https://cdn.discordapp.com/app-assets/383226320970055681/565944799455346703.png
    }
    loadDiscord()
</script>
